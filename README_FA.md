# SharX

[English](README_EN.md) | [Русский](README_RU.md) | [فارسی](README_FA.md)

## به SharX خوش آمدید

**شار ایکس (SharX)** یک فورک از پنل اصلی **3XUI** است که با قابلیت‌ها و امکانات مانیتورینگ پیشرفته‌تر توسعه داده شده است.

این نسخه شامل بهبودهای چشمگیر، معماری مدرن، فرآیند نصب ساده‌شده با استفاده از کانتینرهای Docker و **یکپارچه‌سازی با Grafana** برای مانیتورینگ پیشرفته از طریق Prometheus و Loki می‌باشد.

---

## چه چیزهایی جدید است

### حالت نود (۱ پنل – چندین نود)

* **مدیریت متمرکز**: یک پنل می‌تواند چندین نود را مدیریت کند
* **حالت ثبت‌نام**: در اولین اجرا، نودها در حالت ثبت‌نام اجرا می‌شوند و منتظر اتصال از سمت پنل می‌مانند
* **احراز هویت امن**: پنل یک توکن API صادر می‌کند، نود را امضا کرده و برای استفاده‌های بعدی ذخیره می‌کند
* **معماری مقیاس‌پذیر**: با رشد زیرساخت، به‌راحتی نود اضافه یا حذف کنید

### جداسازی موجودیت‌های Client و Inbound

* **انتساب منعطف کلاینت**: هر کلاینت می‌تواند به چندین inbound اختصاص داده شود
* **اشتراک چند inbound**: تمام inboundهای اختصاص‌یافته در اشتراک نمایش داده می‌شوند
* **انعطاف‌پذیری نود**: چندین نود می‌توانند به یک inbound متصل شوند
* **مدیریت بهتر منابع**: استفاده بهینه‌تر از منابع سرور

### تب Hosts

* **بازنویسی آدرس**: امکان override آدرس نودها در اشتراک‌ها
* **پشتیبانی از Proxy**: مناسب برای نودهایی که پشت پراکسی یا لودبالانسر هستند
* **مسیر‌یابی منعطف**: تنظیم آدرس‌های مختلف هاست برای سناریوهای گوناگون

### یکپارچه‌سازی Redis

* **افزایش کارایی**: افزایش چشمگیر سرعت پاسخ‌دهی رابط کاربری
* **کش هوشمند**: کش کردن کوئری‌های پرتکرار دیتابیس
* **ارائه بهینه داده**: در صورت ثابت بودن پارامترها و معتبر بودن کش، داده مستقیم از Redis ارائه می‌شود
* **کاهش فشار روی دیتابیس**: کاهش بار PostgreSQL

### مهاجرت کامل به PostgreSQL

* **دیتابیس قابل‌اعتماد**: مهاجرت کامل از SQLite به PostgreSQL
* **به‌روزرسانی Import/Export**: بخش بکاپ برای PostgreSQL به‌روزرسانی شده
* **ابزار مهاجرت**: ابزار داخلی مهاجرت از SQLite به PostgreSQL برای کاربران فعلی
* **یکپارچگی داده‌ها**: انتقال کامل و مطمئن داده‌ها در فرآیند مهاجرت

### یکپارچه‌سازی Grafana

* **متریک‌های Prometheus**: جمع‌آوری و مانیتورینگ متریک‌ها به‌صورت لحظه‌ای
* **لاگ‌های Loki**: تجمیع و تحلیل متمرکز لاگ‌ها
* **مانیتورینگ پیشرفته**: داشبوردهای جامع برای عملکرد سیستم
* **هشداردهی**: هشدارهای قابل تنظیم بر اساس متریک‌ها و لاگ‌ها

### مدل توزیع جدید

* **مبتنی بر Docker**: ایمیج‌های آماده Docker برای استقرار آسان
* **چندسکویی**: قابل اجرا روی هر سیستم‌عامل و معماری CPU
* **نصب سریع**: دانلود ایمیج‌های آماده در ۵ تا ۱۰ ثانیه
* **بدون نیاز به کامپایل**: عدم نیاز به کامپایل روی سرورهای ضعیف
* **مهاجرت آسان**: مهاجرت و مقیاس‌پذیری ساده با کانتینر

### HWID دستگاه (بتا)

* **شناسایی سخت‌افزار**: شناسایی دستگاه‌ها با شناسه سخت‌افزاری یکتا برای امنیت بیشتر
* **محافظت از کلاینت**: جلوگیری از دسترسی غیرمجاز و نشت اشتراک
* **کنترل دستگاه‌ها**: محدودسازی و مانیتور دستگاه‌های مجاز هر کلاینت
* **پیکربندی مجزا**: به‌صورت پیش‌فرض غیرفعال و قابل فعال‌سازی برای هر کلاینت
* **پشتیبانی کلاینت**: در حال حاضر در Happ و V2RayTun پشتیبانی می‌شود
* **جلوگیری از نشت**: در صورت لو رفتن اشتراک، فقط دستگاه‌های ثبت‌شده دسترسی دارند
* **مانیتورینگ مصرف**: مشاهده اینکه کدام دستگاه‌ها از هر اکانت استفاده می‌کنند
* **امنیت منعطف**: فعال‌سازی HWID فقط برای کلاینت‌های موردنیاز

---

## نصب

### پیش‌نیازها

* سرور لینوکس (Ubuntu، Debian، CentOS، Fedora، Arch، Alpine، openSUSE)
* دسترسی root
* پورت‌های آزاد:

  * 2053 (پنل وب)
  * 2096 (اشتراک‌ها)
  * 80 (برای دریافت گواهی SSL)

---

## گزینه ۱: نصب خودکار (پیشنهادی)

### نصب تک‌خطی

```bash
bash <(curl -Ls https://raw.githubusercontent.com/konstpic/3x-ui-new/main/install.sh)
```

یا کلون و اجرا:

```bash
git clone https://github.com/konstpic/3x-ui-new.git
cd 3x-ui-new
sudo bash install.sh
```

### اسکریپت نصب چه کاری انجام می‌دهد

* تشخیص توزیع لینوکس
* نصب Docker و Docker Compose
* تنظیم حالت شبکه (host یا bridge)
* راه‌اندازی SSL با Let’s Encrypt (acme.sh)

  * دامنه: گواهی ۹۰ روزه با تمدید خودکار
  * IP: گواهی ۶ روزه با تمدید خودکار
* تولید رمز عبور امن دیتابیس
* ایجاد و اجرای تمام سرویس‌ها

### سیستم‌های پشتیبانی‌شده

| توزیع         | مدیر بسته |
| ------------- | --------- |
| Ubuntu/Debian | apt       |
| Fedora        | dnf       |
| CentOS/RHEL   | yum       |
| Arch Linux    | pacman    |
| Alpine        | apk       |
| openSUSE      | zypper    |

### نصب پنل با اسکریپت

```bash
sudo bash install.sh
```

گزینه **1) Install Panel** را انتخاب کرده و مراحل را دنبال کنید:

1. انتخاب حالت شبکه
2. تنظیم پورت‌های پنل و اشتراک
3. تولید یا وارد کردن رمز دیتابیس
4. انتخاب نوع SSL (دامنه / IP / رد شدن)

### نصب نود با اسکریپت

```bash
sudo bash install.sh
```

گزینه **2) Install Node** را انتخاب کنید:

1. انتخاب حالت شبکه
2. تنظیم پورت API
3. انتخاب نوع SSL

### منوی مدیریت

با اجرای مجدد اسکریپت:

```bash
sudo bash install.sh
```

**گزینه‌ها:**

* **Panel**: نصب، آپدیت، شروع، توقف، ری‌استارت، وضعیت، لاگ‌ها
* **Panel Settings**: تغییر پورت‌ها، تغییر رمز دیتابیس، تمدید/تنظیم گواهی‌ها
* **Node**: نصب، آپدیت، شروع، توقف، ری‌استارت، وضعیت، لاگ‌ها، تمدید گواهی
* **Uninstall**

### آپدیت پنل / نود

```bash
sudo bash install.sh
# انتخاب: 2) Update Panel یا 21) Update Node
```

مراحل آپدیت:

1. دریافت ایمیج جدید Docker
2. توقف و حذف کانتینر قدیمی
3. اجرای کانتینر جدید
4. دیتابیس ری‌استارت نمی‌شود (بدون از دست رفتن داده)

---

## گزینه ۲: نصب دستی

### نصب پنل

1. **کلون یا دانلود ریپازیتوری**

2. **پیکربندی docker-compose.yml**

   * تنظیم رمز دیتابیس در `XUI_DB_PASSWORD` و `POSTGRES_PASSWORD`
   * تنظیم پورت‌ها (پیش‌فرض: 2053، 2096، 5432)
   * در صورت نیاز تنظیم hostname و network_mode

3. **آماده‌سازی گواهی SSL**

   * ایجاد پوشه `cert`
   * کپی فایل‌های `cert.pem` و `privkey.pem`
   * مسیرهای داخل پنل: `/app/cert/`

4. **اجرای سرویس‌ها**

```bash
docker-compose up -d
```

5. **دسترسی به پنل**

```
http://IP:2053
https://IP:2053
```

6. **راه‌اندازی اولیه**

   * ساخت اکانت ادمین
   * تنظیم اولین نود

7. **تنظیم TLS در پنل**

   * دامنه
   * مسیر گواهی: `/app/cert/cert.pem`
   * مسیر کلید خصوصی: `/app/cert/privkey.pem`
   * ری‌استارت کانتینر پس از ذخیره

---

### نصب نود

1. ورود به پوشه `node`
2. تنظیم docker-compose و پورت‌ها
3. (پیشنهادی) تنظیم SSL برای نود با `fullchain.pem` و `privkey.pem`
4. اجرای نود:

```bash
docker-compose up -d
```

5. اتصال از طریق پنل و دریافت توکن API

---

## تنظیمات پیشرفته

* **Host Network Mode** برای کارایی بهتر
* **PostgreSQL**: تنظیم یوزر، دیتابیس و پورت
* **Redis**: به‌صورت خودکار فعال است
* **تنظیمات از طریق Environment Variables** (قابل تغییر فقط از env، نه UI)
* تنظیمات وب پنل، اشتراک، دیتابیس، لاگ، Xray، امنیت، TLS نود

---

## مهاجرت از SQLite

* خروجی گرفتن از پنل قدیمی (نسخه 2.8.5+)
* نصب پنل جدید
* توجه: دامنه پنل قدیمی ممکن است دامنه جدید را overwrite کند
* ایمپورت بکاپ از بخش Settings
* بررسی صحت داده‌ها

---

## عیب‌یابی

```bash
docker-compose ps
docker-compose logs -f
docker-compose restart
docker-compose down
docker-compose down -v
```

---

## مستندات API

* **[مستندات API](docs/API.md)**: توضیح کامل REST API، احراز هویت و مثال‌ها

---

## پشتیبانی

برای مشکلات، سوالات یا مشارکت، به ریپازیتوری پروژه مراجعه کنید.

---

**نکته**: این نسخه کاملاً مبتنی بر Docker است، تمام ایمیج‌ها از پیش ساخته شده‌اند و نیازی به کامپایل یا تنظیمات پیچیده ندارد.
